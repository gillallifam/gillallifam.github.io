<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>

    </style>
</head>

<body>
    <form>
        <label for="title">Title</label>
        <input type="text" name="title" id="title" value="Fight Club">

        <label for="name">Name</label>
        <input type="text" name="name" id="name" value="Tyler">

        <label for="msg">Body</label>
        <textarea id="msg" name="msg">Fight, no speak, and drink some beer.</textarea>

        <!-- <input type="hidden" name="userId" value="1"> -->

        <button>Submit</button>
    </form>
    <script>


        document.addEventListener('submit', function (event) {
            let data = Object.fromEntries(new FormData(event.target))
            console.log(vals.validate(data));
            event.preventDefault();
        });
        class Vals {
            constructor() {
                this.root = this
                this.schema = {
                    title: { mustContains: "Club" },
                    msg: { empty: false, mustNotContains: "Fight Club" },
                    name: { minLen: 3, maxLen: 10, mustContains: "Tyler" },
                    userId: { minLen: 1 }
                    /* age: { min: 3, max: 10 },
                    phone: { onlyNumbers: true },
                    street: { minLen: 3 },
                    hnumber: { isPositive: true },
                    email: { isEmail: true } */
                }
                this.rgx = {
                    emailUser: /^([A-Z0-9_%+\-!#$&'*\/=?^`{|}~]+\.?)*[A-Z0-9_%+\-!#$&'*\/=?^`{|}~]+$/i,
                    emailDomain: /^([A-Z0-9-]+\.?)*[A-Z0-9-]+(\.[A-Z]{2,9})+$/i,
                    onlyNumbers: /^\d+$/
                }
                this.rules = {
                    isArray: (o, flag) => { return Array.isArray(o) === flag },
                    empty: (s, flag) => { return (s === "") === flag },
                    mustContains: (s, v) => { return s.includes(v) },
                    mustNotContains: (s, v) => { return !s.includes(v) },
                    maxLen: (s, v) => { return s.length <= v },
                    minLen: (s, v) => { return s.length >= v },
                    max: (n, v) => { return n <= v },
                    min: (n, v) => { return n >= v },
                    onlyNumbers: (s, b) => { return (this.rgx.onlyNumbers).test(s) === b },
                    minLen: (s, v) => { return s.length >= v },
                    isPositive: (n, b) => { return Number.isInteger(n) & n > 0 },
                    isEmail: (mail, b) => {
                        let p = mail.split("@");
                        if (p.length != 2) return false;
                        return (this.rgx.emailUser.test(p[0]) && this.rgx.emailDomain.test(p[1]));
                    }
                }
            }
            validate(obj) {
                let valid = true
                for (const [oe, ov] of Object.entries(obj)) {
                    if (isObj(ov)) return this.validate(ov, this.schema)
                    let fs = this.schema[oe]
                    if (fs) {
                        console.log(oe, fs);
                        for (const [func, v] of Object.entries(fs)) {
                            if (!this.rules[func]) return false//must be warning
                            if (!this.rules[func](ov, v)) return false//not pass
                        }
                    }

                }
                return true
            }
            validateAll(objs) {
                for (const obj of objs) {
                    if (!this.validate(obj)) return false
                }
                return true
            }
        }

        let vals = new Vals()

        console.log(vals);

        let obj1 = { name: "11kkkkkkkk", age: 3, phone: "988067816", email: "gill@g.com", address: { street: "tst", hnumber: 100 } }
        let obj2 = { name: "11kkkkkkkk", age: 3, phone: "988067816", email: "gill@@g.com", address: { street: "tst", hnumber: 100 } }
        let obj3 = { name: "11kkkkkkkk", age: 3, phone: "988067a816", email: "gill@g.com", address: { street: "tst", hnumber: 100 } }
        let obj4 = { name: "11kkkkkkkk", age: 2, phone: "988067816", email: "gill@g.com", address: { street: "tst", hnumber: 0 } }
        let obj5 = { name: "11kkkkkkkk", age: 3, phone: "988067816", email: "gill@g.com", address: { street: "tst", hnumber: 100 } }

        console.time("validate2")
        /* console.log('obj1', vals.validate(obj1));
        console.log('obj2', vals.validate(obj2));
        console.log('obj3', vals.validate(obj3));
        console.log('obj4', vals.validate(obj4));
        console.log('obj5', vals.validate(obj5));
        console.log('Group1', vals.validateAll([obj1, obj5]));
        console.log('Group2', vals.validateAll([obj1, obj2, obj5])); */
        console.timeEnd("validate2")
        console.log("====================");

        function isObj(x) {
            return typeof x === 'object' && x !== null && !Array.isArray(x)
        }

    </script>

</body>

</html>