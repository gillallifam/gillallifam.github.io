<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../js/utils.js"></script>
    <script src="../js/langs.js"></script>
    <script src="../js/locTest.js"></script>
    <style id="mainStyles">
        p {
            background-color: rgb(255, 220, 192);
            color: rgb(5, 5, 49);
        }
    </style>
</head>

<body>
    <p id="testTarget" class="trans">House</p>
    <p class="trans">house</p>
    <p id="p2" class="trans">Sky</p>
    <p id="p3" class="trans">team</p>
    <p id="p4" class="trans">welcomeMsg</p>
    <p id="p5" class="trans">defMessage</p>
    <p id="p6" class="trans">timeMessage</p>
    <p id="p6b" class="trans">relativeMsg</p>
    <p id="p7" class="trans">AppName</p>
    <p id="p8" class="trans">help</p>
    <p id="p9" class="trans">${tst} ${data}</p>
    <p id="p9b" class="trans">${a} x ${b}</p>
    <p class="trans">star</p>
    <p class="trans">fish</p>
    <button id="bt2" onclick="testAndReport('Translator');" class="trans">Report</button>
    <button id="bt3" onclick="setLang('EN');">EN</button>
    <button id="bt4" onclick="setLang('ES');"> ES</button>
    <button id="bt5" onclick="setLang('PT');"> PT</button>
    <button id="bt6" onclick="setLang('IT');"> IT</button>
    <script>
        var pageName = "Translator"
        var locTest = new LocTest(document.getElementById("tstRoot"))

        function setLang(lang) {
            tt.translateTargets(tt.buildLanguage(lang), tt.getTargets())
        }

        document.addEventListener("DOMContentLoaded", function (event) {
            tt.translateTargets(tt.buildLanguage("EN"), tt.getTargets())
            let r = locTest[pageName]()
            for (const d of r) if (d.status === 'f') { locTest.popUpReport(name, r) }
        });

        function customFunc(name, spec) {
            let type = "func"
            let result = spec.includes("gnrt")
            let msg = { name, type, spec, result, status: "f" }
            if (result === true) msg.status = 's'
            return msg
        }

        function tstTranslator() {
            let reportData = []
            let lc = locTest
            let anId = tt.genID().next().value
            lc.genReport(reportData, customFunc("ID contains gnrt", anId))
            lc.genReport(reportData, lc.comparator("Generate ID", anId, "!==", undefined))
            lc.genReport(reportData, lc.comparator("Generate multiple IDs", anId, "!==", tt.genID().next().value))
            lc.genReport(reportData, lc.comparator("Have langs", Object.keys(tt.allLangs).length, ">=", 1))
            lc.genReport(reportData, lc.comparator("Have targets", Object.keys(tt.getTargets()).length, ">", 0))
            lc.genReport(reportData, lc.comparator("All langs ok", true, "===", tt.testLangs(tt.allLangs)))
            let langEN = tt.buildLanguage("xyz")
            lc.genReport(reportData, lc.comparator("Use default language", "EN", "===", langEN.$langName))
            lc.genReport(reportData, lc.comparator("Test language", "Hello!", "===", langEN.defMessage))
            lc.genReport(reportData, lc.comparator("Build a language", "PT", "===", tt.buildLanguage("PT").$langName))
            tt.translateTargets(tt.buildLanguage("PT"))
            let tstTarget = document.getElementById("testTarget")
            lc.genReport(reportData, lc.comparator("Translate a target", "Casa", "===", tstTarget.innerText))
            tt.translateTargets(tt.buildLanguage("EN"))
            lc.genReport(reportData, lc.comparator("Back to default lang", "House", "===", tstTarget.innerText))
            for (const d of reportData) if (d.status === 'f') { lc.sendErrorReport(reportData) }
            return reportData
        }
        locTest.appendTest(pageName, tstTranslator)

        function testAndReport(name) {
            locTest.popUpReport(name, locTest[pageName]())
        }
    </script>

</body>

</html>