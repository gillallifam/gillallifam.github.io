<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/db.js"></script>
    <script src="https://unpkg.com/idb/build/iife/index-min.js"></script>
    <title>Document</title>
</head>

<body>
    <script>
        var dbPromise = null
        async function initDB() {
            dbPromise = await idb.openDB("myidb", 1, {
                upgrade(db) {
                    console.log(db);
                    db.createObjectStore('keyval');
                },
            });
        }
        initDB();
        const idbKeyval = {
            async get(key) {
                return (await dbPromise).get('keyval', key);
            },
            async set(key, val) {
                return (await dbPromise).put('keyval', val, key);
            },
            async delete(key) {
                return (await dbPromise).delete('keyval', key);
            },
            async clear() {
                return (await dbPromise).clear('keyval');
            },
            async keys() {
                return (await dbPromise).getAllKeys('keyval');
            },
        };
        setTimeout(async () => {
            console.log(dbPromise);
            idbKeyval.set("aaa", "bbb")
            console.log(await idbKeyval.keys());
        }, 1000);
    </script>
</body>

</html>