<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="YIixEsfSCFpRlGZCr0BGVdwQqE-lV8yK4TjbwVfD_KM" />
    <title>ocss</title>
    <link rel="stylesheet" href="/css/stl-ocss.css">
    <style>
        .content {
            width: 100%;
        }

        textarea {
            width: 45%;
            height: 300px;
        }
    </style>
</head>

<body>
    <div class="topnav" id="myTopnav">
        <a href="#ocss" class="active">OCSS</a>
        <a href="#about">Functions</a>
        <a href="#about">About</a>
        <a href="javascript:void(0);" class="icon" id="menuicon" onclick="toggleMenu()">
            &darr;
        </a>
    </div>

    <div class="content">
        <div id="title">
            <h1>OCSS - Object Cascading Style Sheet</h1>
        </div>
        <div id="content-body">
            <p>OCSS is a way to use scss directly in browser, very experimental, but can do some cool
                things.</p>
            <p>With this you can transform scss like obj into css.</p>
            <textarea name="ocsstext" id="ocsstext">
"--main-color": "#963232",
"--color1": "#333",
"--injson": "function () {return Math.abs(-10.15245251);}/f",
"--injson2": "function fromWindow/e",
"#mainDiv": {
    "--scopedvar1": "gold",
    "--scopedvar2": "brown",
    "background-color": "var(--main-color)",
    "text-align": "center",
    "span":{
        "color":"whitesmoke"
    },
    "p":{
        "color": "#333"
    },
    "h1":{
        "color": "#333"
    },
    "button": {
        "background-color": "var(--scopedvar1)",
        "color": "var(--scopedvar2)",
        ":hover":{
            "background-color": "gray"
        }
    }
},
"#subDiv": {
    "--scopedvar1": "gold",
    "--scopedvar2": "brown",
    "background-color": "var(--color1)",
    "text-align": "right",
    "span":{
        "color":"white"
    },
    "p":{
        "color": "#963232"
    },
    "h1":{
        "color": "#963232"
    },
    "button": {
        "background-color": "var(--scopedvar2)",
        "color": "var(--scopedvar1)",
        ":hover":{
            "background-color": "gray"
        }
    }
},
"button": {
    ":hover":{
        "width":"50px",
        "background-color": "black",
        "color": "white",
        "cursor": "pointer"
    }
}
            </textarea>
            <textarea name="ocssoutput" id="ocssoutput" readonly></textarea>
        </div>
    </div>
    <div id="mainDiv" class="mydivs">
        <span>Main</span>
        <h1>Title</h1>
        <p>Paragraph</p>
        <button class="btn">ok</button>
    </div>
    <div id="subDiv" class="mydivs">
        <span>Sub</span>
        <h1>Title</h1>
        <p>Paragraph</p>
        <button class="btn">ok</button>
    </div>
    <p>Other elements</p>
    <button>button</button>
    <script>

        let topnav = document.getElementById("myTopnav");
        let menuicon = document.getElementById("menuicon");

        function toggleMenu() {
            if (topnav.className === "topnav") {
                topnav.className += " responsive";
            } else {
                topnav.className = "topnav";
            }
        }

        function fromWindow() {
            return "from window"
        }
        function executeFunctionByName(functionName, context /*, args */) {
            var args = Array.prototype.slice.call(arguments, 2);
            var namespaces = functionName.split(".");
            var func = namespaces.pop();
            for (var i = 0; i < namespaces.length; i++) {
                context = context[namespaces[i]];
            }
            return context[func].apply(context, args);
        }

        let JSONF = (str) => {
            return JSON.parse(str, function (key, value) {
                if (typeof value === "string" && value.startsWith("function")) {
                    value = value.substring(0, value.length - 2);
                    if (value.endsWith("/f")) return (0, eval)("(" + value + ")");
                    if (value.endsWith("/e")) return window[value.split(" ")[1]]
                }
                return value;
            });
        }

        let ocsstext = document.getElementById("ocsstext")
        let ocssoutput = document.getElementById("ocssoutput")
        let parsed = JSONF("{" + ocsstext.innerHTML + "}")
        parsed["--color2"] = "orange//added in code"
        ocssoutput.innerHTML = ocss(parsed)
        appendStyle(ocss(parsed), "myexstyles")

        ocsstext.addEventListener('input', function () {
            let json = JSON.parse("{" + ocsstext.value + "}")
            let parsed = ocss(json)
            ocssoutput.innerHTML = parsed
            appendStyle(parsed, "myexstyles")
        }, false);


        function appendStyle(str, id = "rootocss") {
            document.getElementById(id) && e.remove()

            const style = document.createElement('style');
            style.id = id
            style.textContent = str;
            document.head.append(style);
        }

        function ocss(obj, opt) {
            let vars = "";
            let gCss = "";
            (function g(path, o) {
                let entry = "", props = [], nested = []
                Object.entries(o).forEach((e) => {
                    if (typeof e[1] === 'object' && e[1] !== null) { nested.push(e) } else props.push(e)
                })
                props.forEach(([k, v], i, a) => {
                    if (typeof v === "function") v = v()
                    if (k.startsWith("--") && !path) {
                        if (!vars) vars += ":root {\n"
                        vars += `${k}:${v};\n`
                        return
                    }
                    entry += `${k}:${v};`
                });
                if (entry) gCss += `${path} {${entry}}\n`
                nested.forEach(([k, v]) => {
                    k.charAt(0) === ":" ? g(path + k, v) : g(`${path} ${k}`, v)
                })
            })("", obj);
            if (vars) vars += "}"
            return vars + "\n" + gCss;
        }
    </script>
</body>

</html>